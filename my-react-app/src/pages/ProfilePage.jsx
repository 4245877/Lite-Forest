// src/pages/ProfilePage.jsx
import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../auth';
import styles from './ProfilePage.module.css';

// –ù–µ–±–æ–ª—å—à–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–¥–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Äî –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ–∑–∂–µ
const Overview = ({ user }) => (
  <section className={styles.section} aria-label="Overview">
    <h2 className={styles.sectionTitle}>–û–≥–ª—è–¥</h2>
    <div className={styles.card}>
      <h3>–ü—Ä–æ—Ñ—ñ–ª—å</h3>
      <p><strong>–Ü–º'—è:</strong> {user?.name}</p>
      <p><strong>Email:</strong> {user?.email}</p>
      <Link to="/profile/edit" className={styles.linkBtn}>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</Link>
    </div>
    <div className={styles.card}>
      <h3>–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h3>
      <div className={styles.actionsRow}>
        <Link to="/orders" className={styles.action}>–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</Link>
        <Link to="/favorites" className={styles.action}>–û–±—Ä–∞–Ω–µ</Link>
      </div>
    </div>
  </section>
);

const Orders = () => {
  // —Ç–∏–º—á–∞—Å–æ–≤—ñ –¥–∞–Ω—ñ ‚Äî –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ –∑ API
  const demoOrders = [
    { id: 'ORD-1001', date: '2025-07-09', total: '‚Ç¥1,200', status: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω' },
    { id: 'ORD-1005', date: '2025-08-02', total: '‚Ç¥450', status: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ' },
  ];

  return (
    <section className={styles.section} aria-label="Orders">
      <h2 className={styles.sectionTitle}>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
      {demoOrders.length === 0 ? (
        <p>–£ –≤–∞—Å –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å.</p>
      ) : (
        <ul className={styles.ordersList}>
          {demoOrders.map(o => (
            <li key={o.id} className={styles.orderItem}>
              <div className={styles.orderHead}>
                <strong>{o.id}</strong>
                <span>{o.date}</span>
              </div>
              <div className={styles.orderFoot}>
                <span>{o.total}</span>
                <span className={styles.status}>{o.status}</span>
                <Link to={`/orders/${o.id}`} className={styles.btnSmall}>–î–æ–∫–ª–∞–¥–Ω—ñ—à–µ</Link>
              </div>
            </li>
          ))}
        </ul>
      )}
    </section>
  );
};

const Addresses = () => (
  <section className={styles.section} aria-label="Addresses">
    <h2 className={styles.sectionTitle}>–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
    <div className={styles.card}>
      <p>–î–æ–¥–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –¥–ª—è —à–≤–∏–¥–∫–æ—ó –¥–æ—Å—Ç–∞–≤–∫–∏.</p>
      <Link to="/profile/addresses" className={styles.linkBtn}>–ö–µ—Ä—É–≤–∞—Ç–∏ –∞–¥—Ä–µ—Å–∞–º–∏</Link>
    </div>
  </section>
);

const ProfilePage = () => {
  const [tab, setTab] = useState('overview');
  const { user, loading, signout } = useAuth();
  const navigate = useNavigate();

  const displayName = user?.name || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á';
  const firstLetter = displayName?.trim()?.[0]?.toUpperCase() || 'üôÇ';

  const handleLogout = async () => {
    await signout();
    navigate('/', { replace: true });
  };

  if (loading) {
    return (
      <div className={styles.container}>
        <div className={styles.headerRow}>
          <h1 className={styles.title}>–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</h1>
          <div className={styles.smallNote}>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>
        </div>
      </div>
    );
  }

  // –î–æ–ø. –∑–∞—Ö–∏—Å—Ç: —è–∫—â–æ –∑ —è–∫–æ—ó—Å—å –ø—Ä–∏—á–∏–Ω–∏ user –≤—ñ–¥—Å—É—Ç–Ω—ñ–π (–Ω–µ–ø–æ–≤–Ω–∞ —Å–µ—Å—ñ—è)
  if (!user) {
    return (
      <div className={styles.container}>
        <div className={styles.headerRow}>
          <h1 className={styles.title}>–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</h1>
          <div className={styles.smallNote}>
            –í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ. <Link to="/login" className={styles.linkBtn}>–£–≤—ñ–π—Ç–∏</Link>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      <div className={styles.headerRow}>
        <h1 className={styles.title}>–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</h1>
        <div className={styles.smallNote}>
          –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ, <strong>{displayName.split(' ')[0]}</strong>
        </div>
      </div>

      <div className={styles.grid}>
        <aside className={styles.sidebar}>
          <div className={styles.userCard}>
            <div className={styles.avatar} aria-hidden>{firstLetter}</div>
            <div className={styles.userInfo}>
              <div className={styles.userName}>{displayName}</div>
              <div className={styles.userEmail}>{user.email}</div>
            </div>
          </div>

          <nav className={styles.menu} aria-label="–ü–∞–Ω–µ–ª—å –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó">
            <button
              onClick={() => setTab('overview')}
              className={`${styles.menuItem} ${tab === 'overview' ? styles.active : ''}`}
            >
              –û–±–∑–æ—Ä
            </button>
            <button
              onClick={() => setTab('orders')}
              className={`${styles.menuItem} ${tab === 'orders' ? styles.active : ''}`}
            >
              –ó–∞–∫–∞–∑—ã
            </button>
            <button
              onClick={() => setTab('addresses')}
              className={`${styles.menuItem} ${tab === 'addresses' ? styles.active : ''}`}
            >
              –ê–¥—Ä–µ—Å–∏
            </button>

            <Link to="/favorites" className={styles.menuItemLink}>–û–±—Ä–∞–Ω–µ</Link>
            <Link to="/profile/settings" className={styles.menuItemLink}>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</Link>
            <Link to="/" className={styles.menuItemLink}>–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ –º–∞–≥–∞–∑–∏–Ω—É</Link>

            <button onClick={handleLogout} className={styles.menuItem}>
              –í–∏–π—Ç–∏
            </button>
          </nav>
        </aside>

        <main className={styles.main}>
          {tab === 'overview' && <Overview user={user} />}
          {tab === 'orders' && <Orders />}
          {tab === 'addresses' && <Addresses />}
        </main>
      </div>
    </div>
  );
};

export default ProfilePage;

/*
  –ü—ñ–¥–∫–∞–∑–∫–∏:
  - user –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —ñ–∑ useAuth() (–¥–∏–≤. src/auth), —è–∫–∏–π –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ /api/auth/me.
  - –ó–∞–º—ñ–Ω—ñ—Ç—å demoOrders –Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑ –≤–∞—à–æ–≥–æ API.
*/
